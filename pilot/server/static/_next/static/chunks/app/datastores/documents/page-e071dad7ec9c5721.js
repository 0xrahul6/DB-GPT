(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{78141:function(e,t,a){"use strict";var i=a(78997);t.Z=void 0;var r=i(a(76906)),n=a(9268),o=(0,r.default)((0,n.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"}),"Cached");t.Z=o},42414:function(e,t,a){Promise.resolve().then(a.bind(a,16692))},16692:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ei}});var i=a(9268),r=a(56008),n=a(86006),o=a(50645),s=a(5737),l=a(78635),c=a(80937),d=a(44334),h=a(311),p=a(22046),u=a(53113),g=a(83192),m=a(46750),x=a(40431),v=a(89791),f=a(47562),C=a(46319),b=a(53832),j=a(49657),Z=a(88930),y=a(47093),P=a(18587);function S(e){return(0,P.d6)("MuiChip",e)}let w=(0,P.sI)("MuiChip",["root","clickable","colorPrimary","colorNeutral","colorDanger","colorInfo","colorSuccess","colorWarning","colorContext","disabled","endDecorator","focusVisible","label","labelSm","labelMd","labelLg","sizeSm","sizeMd","sizeLg","startDecorator","variantPlain","variantSolid","variantSoft","variantOutlined"]),_=n.createContext({disabled:void 0,variant:void 0,color:void 0});var k=a(326);let R=["children","className","color","onClick","disabled","size","variant","startDecorator","endDecorator","component","slots","slotProps"],z=e=>{let{disabled:t,size:a,color:i,clickable:r,variant:n,focusVisible:o}=e,s={root:["root",t&&"disabled",i&&`color${(0,b.Z)(i)}`,a&&`size${(0,b.Z)(a)}`,n&&`variant${(0,b.Z)(n)}`,r&&"clickable"],action:["action",t&&"disabled",o&&"focusVisible"],label:["label",a&&`label${(0,b.Z)(a)}`],startDecorator:["startDecorator"],endDecorator:["endDecorator"]};return(0,f.Z)(s,S,{})},D=(0,o.Z)("div",{name:"JoyChip",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e,ownerState:t})=>{var a,i,r,n;return[(0,x.Z)({"--Chip-decoratorChildOffset":"min(calc(var(--Chip-paddingInline) - (var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2), var(--Chip-paddingInline))","--Chip-decoratorChildRadius":"max(var(--_Chip-radius) - var(--variant-borderWidth, 0px) - var(--_Chip-paddingBlock), min(var(--_Chip-paddingBlock) + var(--variant-borderWidth, 0px), var(--_Chip-radius) / 2))","--Chip-deleteRadius":"var(--Chip-decoratorChildRadius)","--Chip-deleteSize":"var(--Chip-decoratorChildHeight)","--Avatar-radius":"var(--Chip-decoratorChildRadius)","--Avatar-size":"var(--Chip-decoratorChildHeight)","--Icon-margin":"initial","--unstable_actionRadius":"var(--_Chip-radius)"},"sm"===t.size&&{"--Chip-gap":"0.25rem","--Chip-paddingInline":"0.5rem","--Chip-decoratorChildHeight":"calc(min(1.125rem, var(--_Chip-minHeight)) - 2 * var(--variant-borderWidth, 0px))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 1.714)","--_Chip-minHeight":"var(--Chip-minHeight, 1.5rem)",fontSize:e.vars.fontSize.xs},"md"===t.size&&{"--Chip-gap":"0.375rem","--Chip-paddingInline":"0.75rem","--Chip-decoratorChildHeight":"min(1.375rem, var(--_Chip-minHeight))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 1.778)","--_Chip-minHeight":"var(--Chip-minHeight, 2rem)",fontSize:e.vars.fontSize.sm},"lg"===t.size&&{"--Chip-gap":"0.5rem","--Chip-paddingInline":"1rem","--Chip-decoratorChildHeight":"min(1.75rem, var(--_Chip-minHeight))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 2)","--_Chip-minHeight":"var(--Chip-minHeight, 2.5rem)",fontSize:e.vars.fontSize.md},{"--_Chip-radius":"var(--Chip-radius, 1.5rem)","--_Chip-paddingBlock":"max((var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2, 0px)",minHeight:"var(--_Chip-minHeight)",maxWidth:"max-content",paddingInline:"var(--Chip-paddingInline)",borderRadius:"var(--_Chip-radius)",position:"relative",fontWeight:e.vars.fontWeight.md,fontFamily:e.vars.fontFamily.body,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",textDecoration:"none",verticalAlign:"middle",boxSizing:"border-box",[`&.${w.disabled}`]:{color:null==(a=e.variants[`${t.variant}Disabled`])||null==(a=a[t.color])?void 0:a.color}}),...t.clickable?[{"--variant-borderWidth":"0px",color:null==(n=e.variants[t.variant])||null==(n=n[t.color])?void 0:n.color}]:[null==(i=e.variants[t.variant])?void 0:i[t.color],{[`&.${w.disabled}`]:null==(r=e.variants[`${t.variant}Disabled`])?void 0:r[t.color]}]]}),I=(0,o.Z)("span",{name:"JoyChip",slot:"Label",overridesResolver:(e,t)=>t.label})(({ownerState:e})=>(0,x.Z)({display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",order:1,minInlineSize:0,flexGrow:1},e.clickable&&{zIndex:1,pointerEvents:"none"})),H=(0,o.Z)("button",{name:"JoyChip",slot:"Action",overridesResolver:(e,t)=>t.action})(({theme:e,ownerState:t})=>{var a,i,r,n;return[{position:"absolute",zIndex:0,top:0,left:0,bottom:0,right:0,width:"100%",border:"none",cursor:"pointer",padding:"initial",margin:"initial",backgroundColor:"initial",textDecoration:"none",borderRadius:"inherit",[e.focus.selector]:e.focus.default},null==(a=e.variants[t.variant])?void 0:a[t.color],{"&:hover":null==(i=e.variants[`${t.variant}Hover`])?void 0:i[t.color]},{"&:active":null==(r=e.variants[`${t.variant}Active`])?void 0:r[t.color]},{[`&.${w.disabled}`]:null==(n=e.variants[`${t.variant}Disabled`])?void 0:n[t.color]}]}),N=(0,o.Z)("span",{name:"JoyChip",slot:"StartDecorator",overridesResolver:(e,t)=>t.startDecorator})({"--Avatar-marginInlineStart":"calc(var(--Chip-decoratorChildOffset) * -1)","--Chip-deleteMargin":"0 0 0 calc(var(--Chip-decoratorChildOffset) * -1)","--Icon-margin":"0 0 0 calc(var(--Chip-paddingInline) / -4)",display:"inherit",marginInlineEnd:"var(--Chip-gap)",order:0,zIndex:1,pointerEvents:"none"}),F=(0,o.Z)("span",{name:"JoyChip",slot:"EndDecorator",overridesResolver:(e,t)=>t.endDecorator})({"--Chip-deleteMargin":"0 calc(var(--Chip-decoratorChildOffset) * -1) 0 0","--Icon-margin":"0 calc(var(--Chip-paddingInline) / -4) 0 0",display:"inherit",marginInlineStart:"var(--Chip-gap)",order:2,zIndex:1,pointerEvents:"none"}),T=n.forwardRef(function(e,t){let a=(0,Z.Z)({props:e,name:"JoyChip"}),{children:r,className:o,color:s="primary",onClick:l,disabled:c=!1,size:d="md",variant:h="solid",startDecorator:p,endDecorator:u,component:g,slots:f={},slotProps:b={}}=a,P=(0,m.Z)(a,R),{getColor:S}=(0,y.VT)(h),w=S(e.color,s),T=!!l||!!b.action,O=(0,x.Z)({},a,{disabled:c,size:d,color:w,variant:h,clickable:T,focusVisible:!1}),E="function"==typeof b.action?b.action(O):b.action,W=n.useRef(null),{focusVisible:L,getRootProps:M}=(0,C.Z)((0,x.Z)({},E,{disabled:c,rootRef:W}));O.focusVisible=L;let A=z(O),U=(0,x.Z)({},P,{component:g,slots:f,slotProps:b}),[$,B]=(0,k.Z)("root",{ref:t,className:(0,v.Z)(A.root,o),elementType:D,externalForwardedProps:U,ownerState:O}),[J,V]=(0,k.Z)("label",{className:A.label,elementType:I,externalForwardedProps:U,ownerState:O}),Y=(0,j.Z)(V.id),[G,K]=(0,k.Z)("action",{className:A.action,elementType:H,externalForwardedProps:U,ownerState:O,getSlotProps:M,additionalProps:{"aria-labelledby":Y,as:null==E?void 0:E.component,onClick:l}}),[X,q]=(0,k.Z)("startDecorator",{className:A.startDecorator,elementType:N,externalForwardedProps:U,ownerState:O}),[Q,ee]=(0,k.Z)("endDecorator",{className:A.endDecorator,elementType:F,externalForwardedProps:U,ownerState:O}),et=n.useMemo(()=>({disabled:c,variant:h,color:"context"===w?void 0:w}),[w,c,h]);return(0,i.jsx)(_.Provider,{value:et,children:(0,i.jsxs)($,(0,x.Z)({},B,{children:[T&&(0,i.jsx)(G,(0,x.Z)({},K)),(0,i.jsx)(J,(0,x.Z)({},V,{id:Y,children:r})),p&&(0,i.jsx)(X,(0,x.Z)({},q,{children:p})),u&&(0,i.jsx)(Q,(0,x.Z)({},ee,{children:u}))]}))})});var O=a(81528),E=a(90545),W=a(35086),L=a(866),M=a(28086),A=a(65326),U=a.n(A),$=a(72474),B=a(59534),J=a(78141),V=a(68949),Y=a(50157),G=a(23910),K=a(21628),X=a(1031),q=a(78915);let{Dragger:Q}=Y.default,ee=(0,o.Z)(s.Z)(e=>{let{theme:t}=e;return{width:"50%",backgroundColor:"dark"===t.palette.mode?t.palette.background.level1:"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",borderRadius:4,color:t.vars.palette.text.secondary}}),et=["Choose a Datasource type","Setup the Datasource"],ea=[{type:"text",title:"Text",subTitle:"Fill your raw text"},{type:"webPage",title:"URL",subTitle:"Fetch the content of a URL"},{type:"file",title:"Document",subTitle:"Upload a document, document type can be PDF, CSV, Text, PowerPoint, Word, Markdown"}];var ei=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("name"),{mode:a}=(0,l.tv)(),[o,m]=(0,n.useState)(!1),[x,v]=(0,n.useState)(0),[f,C]=(0,n.useState)(""),[b,j]=(0,n.useState)([]),[Z,y]=(0,n.useState)(""),[P,S]=(0,n.useState)(""),[w,_]=(0,n.useState)(""),[k,R]=(0,n.useState)(""),[z,D]=(0,n.useState)(null),[I,H]=(0,n.useState)(0),[N,F]=(0,n.useState)(0),[A,Y]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async function(){let e=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:1,page_size:20});e.success&&(j(e.data.data),H(e.data.total),F(e.data.page))})()},[]),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:"20px"},children:[(0,i.jsxs)(d.Z,{"aria-label":"breadcrumbs",children:[(0,i.jsx)(h.Z,{onClick:()=>{e.push("/datastores")},underline:"hover",color:"neutral",fontSize:"inherit",children:"Knowledge Space"},"Knowledge Space"),(0,i.jsx)(p.ZP,{fontSize:"inherit",children:"Documents"})]}),(0,i.jsx)(u.Z,{variant:"outlined",onClick:()=>m(!0),children:"+ Add Datasource"})]}),b.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(g.Z,{color:"primary",variant:"plain",size:"sm",sx:{"& tbody tr: hover":{backgroundColor:"light"===a?"rgb(246, 246, 246)":"rgb(33, 33, 40)"},"& tbody tr: hover a":{textDecoration:"underline"}},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Name"}),(0,i.jsx)("th",{children:"Type"}),(0,i.jsx)("th",{children:"Size"}),(0,i.jsx)("th",{children:"Last Synch"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Result"}),(0,i.jsx)("th",{children:"Operation"})]})}),(0,i.jsx)("tbody",{children:b.map(a=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:a.doc_name}),(0,i.jsx)("td",{children:(0,i.jsx)(T,{variant:"solid",color:"neutral",sx:{opacity:.5},children:a.doc_type})}),(0,i.jsxs)("td",{children:[a.chunk_size," chunks"]}),(0,i.jsx)("td",{children:U()(a.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,i.jsx)("td",{children:(0,i.jsx)(T,{sx:{opacity:.5},variant:"solid",color:function(){switch(a.status){case"TODO":return"neutral";case"RUNNING":return"primary";case"FINISHED":return"success";case"FAILED":return"danger"}}(),children:a.status})}),(0,i.jsx)("td",{children:"TODO"===a.status||"RUNNING"===a.status?"":"FINISHED"===a.status?(0,i.jsx)(G.Z,{content:a.result,trigger:"hover",children:(0,i.jsx)(T,{variant:"solid",color:"success",sx:{opacity:.5},children:"SUCCESS"})}):(0,i.jsx)(G.Z,{content:a.result,trigger:"hover",children:(0,i.jsx)(T,{variant:"solid",color:"danger",sx:{opacity:.5},children:"FAILED"})})}),(0,i.jsx)("td",{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.Z,{variant:"outlined",size:"sm",sx:{marginRight:"20px"},onClick:async()=>{let e=await (0,q.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[a.id]});e.success?K.ZP.success("success"):K.ZP.error(e.err_msg||"failed")},children:["Synch",(0,i.jsx)(J.Z,{})]}),(0,i.jsx)(u.Z,{variant:"outlined",size:"sm",sx:{marginRight:"20px"},onClick:()=>{e.push("/datastores/documents/chunklist?spacename=".concat(t,"&documentid=").concat(a.id))},children:"Details"}),(0,i.jsxs)(u.Z,{variant:"outlined",size:"sm",color:"danger",onClick:async()=>{let e=await (0,q.PR)("/knowledge/".concat(t,"/document/delete"),{doc_name:a.doc_name});if(e.success){K.ZP.success("success");let e=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),F(e.data.page))}else K.ZP.error(e.err_msg||"failed")},children:["Delete",(0,i.jsx)(V.Z,{})]})]})})]},a.id))})]}),(0,i.jsx)(c.Z,{direction:"row",justifyContent:"flex-end",sx:{marginTop:"20px"},children:(0,i.jsx)(X.Z,{defaultPageSize:20,showSizeChanger:!1,current:N,total:I,onChange:async e=>{let a=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:e,page_size:20});a.success&&(j(a.data.data),H(a.data.total),F(a.data.page))},hideOnSinglePage:!0})})]}):(0,i.jsx)(i.Fragment,{}),(0,i.jsx)(O.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center","z-index":1e3},open:o,onClose:()=>m(!1),children:(0,i.jsxs)(s.Z,{variant:"outlined",sx:{width:800,borderRadius:"md",p:3,boxShadow:"lg"},children:[(0,i.jsx)(E.Z,{sx:{width:"100%"},children:(0,i.jsx)(c.Z,{spacing:2,direction:"row",children:et.map((e,t)=>(0,i.jsxs)(ee,{sx:{fontWeight:x===t?"bold":"",color:x===t?"#2AA3FF":""},children:[t<x?(0,i.jsx)(B.Z,{}):"".concat(t+1,"."),"".concat(e)]},e))})}),0===x?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E.Z,{sx:{margin:"30px auto"},children:ea.map(e=>(0,i.jsxs)(s.Z,{sx:{boxSizing:"border-box",height:"80px",padding:"12px",display:"flex",flexDirection:"column",justifyContent:"space-between",border:"1px solid gray",borderRadius:"6px",marginBottom:"20px",cursor:"pointer"},onClick:()=>{C(e.type),v(1)},children:[(0,i.jsx)(s.Z,{sx:{fontSize:"20px",fontWeight:"bold"},children:e.title}),(0,i.jsx)(s.Z,{children:e.subTitle})]},e.type))})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(E.Z,{sx:{margin:"30px auto"},children:["Name:",(0,i.jsx)(W.ZP,{placeholder:"Please input the name",onChange:e=>S(e.target.value),sx:{marginBottom:"20px"}}),"webPage"===f?(0,i.jsxs)(i.Fragment,{children:["Web Page URL:",(0,i.jsx)(W.ZP,{placeholder:"Please input the Web Page URL",onChange:e=>y(e.target.value)})]}):"file"===f?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(Q,{name:"file",multiple:!1,onChange(e){var t;if(console.log(e),0===e.fileList.length){D(null),S("");return}D(e.file.originFileObj),S(null===(t=e.file.originFileObj)||void 0===t?void 0:t.name)},children:[(0,i.jsx)("p",{className:"ant-upload-drag-icon",children:(0,i.jsx)($.Z,{})}),(0,i.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:"Select or Drop file"}),(0,i.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})}):(0,i.jsxs)(i.Fragment,{children:["Text Source(Optional):",(0,i.jsx)(W.ZP,{placeholder:"Please input the text source",onChange:e=>_(e.target.value),sx:{marginBottom:"20px"}}),"Text:",(0,i.jsx)(L.Z,{onChange:e=>R(e.target.value),minRows:4,sx:{marginBottom:"20px"}})]}),(0,i.jsx)(p.ZP,{component:"label",sx:{marginTop:"20px"},endDecorator:(0,i.jsx)(M.Z,{checked:A,onChange:e=>Y(e.target.checked)}),children:"Synch:"})]}),(0,i.jsxs)(c.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",sx:{marginBottom:"20px"},children:[(0,i.jsx)(u.Z,{variant:"outlined",sx:{marginRight:"20px"},onClick:()=>v(0),children:"< Back"}),(0,i.jsx)(u.Z,{variant:"outlined",onClick:async()=>{if(""===P){K.ZP.error("Please input the name");return}if("webPage"===f){if(""===Z){K.ZP.error("Please input the Web Page URL");return}let e=await (0,q.PR)("/knowledge/".concat(t,"/document/add"),{doc_name:P,content:Z,doc_type:"URL"});if(e.success&&A&&(0,q.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[e.data]}),e.success){K.ZP.success("success"),m(!1);let e=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),F(e.data.page))}else K.ZP.error(e.err_msg||"failed")}else if("file"===f){if(!z){K.ZP.error("Please select a file");return}let e=new FormData;e.append("doc_name",P),e.append("doc_file",z),e.append("doc_type","DOCUMENT");let a=await (0,q.Ej)("/knowledge/".concat(t,"/document/upload"),e);if(a.success&&A&&(0,q.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[a.data]}),a.success){K.ZP.success("success"),m(!1);let e=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),F(e.data.page))}else K.ZP.error(a.err_msg||"failed")}else{if(""===k){K.ZP.error("Please input the text");return}let e=await (0,q.PR)("/knowledge/".concat(t,"/document/add"),{doc_name:P,source:w,content:k,doc_type:"TEXT"});if(e.success&&A&&(0,q.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[e.data]}),e.success){K.ZP.success("success"),m(!1);let e=await (0,q.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),F(e.data.page))}else K.ZP.error(e.err_msg||"failed")}},children:"Finish"})]})]})]})})]})}},78915:function(e,t,a){"use strict";a.d(t,{Tk:function(){return d},Kw:function(){return h},PR:function(){return p},Ej:function(){return u}});var i=a(21628),r=a(24214),n=a(52040);let o=r.Z.create({baseURL:n.env.API_BASE_URL});o.defaults.timeout=1e4,o.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var s=a(84835);let l={"content-type":"application/json"},c=e=>{if(!(0,s.isPlainObject)(e))return JSON.stringify(e);let t={...e};for(let e in t){let a=t[e];"string"==typeof a&&(t[e]=a.trim())}return JSON.stringify(t)},d=(e,t)=>{if(t){let a=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");a&&(e+="?".concat(a))}return o.get("/api"+e,{headers:l}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},h=(e,t)=>{let a=c(t);return o.post("/api"+e,{body:a,headers:l}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},p=(e,t)=>(c(t),o.post(e,t,{headers:l}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})),u=(e,t)=>o.post(e,t).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[180,550,838,60,341,86,679,144,790,946,767,957,872,253,769,744],function(){return e(e.s=42414)}),_N_E=e.O()}]);