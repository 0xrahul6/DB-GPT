(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{22199:function(e,t,a){Promise.resolve().then(a.bind(a,42069))},74724:function(e,t,a){"use strict";a.d(t,{S:function(){return n}});let n="http://localhost:5000"},42069:function(e,t,a){"use strict";a.r(t);var n=a(9268),s=a(56008),o=a(86006),i=a(50645),c=a(5737),r=a(78635),l=a(99987),d=a(83192),h=a(58927),u=a(70900),p=a(11437),x=a(90545),g=a(35086),f=a(866),m=a(65326),j=a.n(m),y=a(72474),S=a(50157),w=a(3748),b=a(18434),P=a(74724);let{Dragger:Z}=S.default,C=(0,i.Z)(c.Z)(e=>{let{theme:t}=e;return{width:"50%",backgroundColor:"dark"===t.palette.mode?t.palette.background.level1:"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",borderRadius:4,color:t.vars.palette.text.secondary}}),T=["Choose a Datasource type","Setup the Datasource"],k=[{type:"text",title:"Text",subTitle:"Fill your raw text"},{type:"webPage",title:"URL",subTitle:"Fetch the content of a URL"},{type:"file",title:"Document",subTitle:"Upload a document, document type can be PDF, CSV, Text, PowerPoint, Word, Markdown"}];t.default=()=>{let e=(0,s.useRouter)(),t=(0,s.useSearchParams)().get("name"),{mode:a}=(0,r.tv)(),[i,m]=(0,o.useState)(!1),[S,O]=(0,o.useState)(0),[_,v]=(0,o.useState)(""),[N,D]=(0,o.useState)([]),[F,z]=(0,o.useState)(""),[R,E]=(0,o.useState)(""),[L,U]=(0,o.useState)(""),[W,J]=(0,o.useState)(""),[M,I]=(0,o.useState)(null),[B,Y]=(0,o.useState)(0),[A,H]=(0,o.useState)(0);return(0,o.useEffect)(()=>{(async function(){let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,page_size:20})}),a=await e.json();a.success&&(D(a.data.data),Y(a.data.total),H(a.data.page))})()},[]),(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)(c.Z,{sx:{display:"flex",flexDirection:"row-reverse"},children:(0,n.jsx)(l.Z,{variant:"outlined",onClick:()=>m(!0),children:"+ Add Datasource"})}),N.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{color:"info",variant:"soft",size:"lg",sx:{"& tbody tr: hover":{backgroundColor:"light"===a?"rgb(246, 246, 246)":"rgb(33, 33, 40)"},"& tbody tr: hover a":{textDecoration:"underline"}},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Name"}),(0,n.jsx)("th",{children:"Type"}),(0,n.jsx)("th",{children:"Size"}),(0,n.jsx)("th",{children:"Last Synch"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Operation"})]})}),(0,n.jsx)("tbody",{children:N.map(a=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:a.doc_name}),(0,n.jsx)("td",{children:(0,n.jsx)(h.Z,{variant:"soft",color:"neutral",sx:{fontWeight:300},children:a.doc_type})}),(0,n.jsxs)("td",{children:[a.chunk_size," chunks"]}),(0,n.jsx)("td",{children:j()(a.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,n.jsx)("td",{children:(0,n.jsx)(h.Z,{sx:{fontWeight:300},variant:"soft",color:function(){switch(a.status){case"TODO":return"neutral";case"RUNNING":return"primary";case"FINISHED":return"success";case"FAILED":return"danger"}}(),children:a.status})}),(0,n.jsx)("td",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{variant:"outlined",size:"sm",onClick:async()=>{let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/sync"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doc_ids:[a.id]})}),n=await e.json();n.success?w.ZP.success("success"):w.ZP.error(n.err_msg||"failed")},children:"Synch"}),(0,n.jsx)(l.Z,{variant:"outlined",size:"sm",onClick:()=>{e.push("/datastores/documents/chunklist?spacename=".concat(t,"&documentid=").concat(a.id))},children:"Detail of Chunks"})]})})]},a.id))})]}),(0,n.jsx)(u.Z,{direction:"row",justifyContent:"flex-end",sx:{marginTop:"20px"},children:(0,n.jsx)(b.Z,{defaultPageSize:20,showSizeChanger:!1,current:A,total:B,onChange:async e=>{let a=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,page_size:20})}),n=await a.json();n.success&&(D(n.data.data),Y(n.data.total),H(n.data.page))},hideOnSinglePage:!0})})]}):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(p.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center","z-index":1e3},open:i,onClose:()=>m(!1),children:(0,n.jsxs)(c.Z,{variant:"outlined",sx:{width:800,borderRadius:"md",p:3,boxShadow:"lg"},children:[(0,n.jsx)(x.Z,{sx:{width:"100%"},children:(0,n.jsx)(u.Z,{spacing:2,direction:"row",children:T.map((e,t)=>(0,n.jsx)(C,{sx:{fontWeight:S===t?"bold":""},children:e},e))})}),0===S?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(x.Z,{sx:{margin:"30px auto"},children:k.map(e=>(0,n.jsxs)(c.Z,{sx:{boxSizing:"border-box",height:"80px",padding:"12px",display:"flex",flexDirection:"column",justifyContent:"space-between",border:"1px solid gray",borderRadius:"6px",marginBottom:"20px",cursor:"pointer"},onClick:()=>{v(e.type),O(1)},children:[(0,n.jsx)(c.Z,{sx:{fontSize:"20px",fontWeight:"bold"},children:e.title}),(0,n.jsx)(c.Z,{children:e.subTitle})]},e.type))})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(x.Z,{sx:{margin:"30px auto"},children:["Name:",(0,n.jsx)(g.ZP,{placeholder:"Please input the name",onChange:e=>E(e.target.value),sx:{marginBottom:"20px"}}),"webPage"===_?(0,n.jsxs)(n.Fragment,{children:["Web Page URL:",(0,n.jsx)(g.ZP,{placeholder:"Please input the Web Page URL",onChange:e=>z(e.target.value)})]}):"file"===_?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(Z,{name:"file",multiple:!1,onChange(e){var t;if(console.log(e),0===e.fileList.length){I(null),E("");return}I(e.file.originFileObj),E(null===(t=e.file.originFileObj)||void 0===t?void 0:t.name)},children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(y.Z,{})}),(0,n.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:"Select or Drop file"}),(0,n.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})}):(0,n.jsxs)(n.Fragment,{children:["Text Source(Optional):",(0,n.jsx)(g.ZP,{placeholder:"Please input the text source",onChange:e=>U(e.target.value),sx:{marginBottom:"20px"}}),"Text:",(0,n.jsx)(f.Z,{onChange:e=>J(e.target.value),minRows:4,sx:{marginBottom:"20px"}})]})]}),(0,n.jsx)(l.Z,{onClick:async()=>{if(""===R){w.ZP.error("Please input the name");return}if("webPage"===_){if(""===F){w.ZP.error("Please input the Web Page URL");return}let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/add"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doc_name:R,content:F,doc_type:"URL"})}),a=await e.json();if(a.success){w.ZP.success("success"),m(!1);let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:A,page_size:20})}),a=await e.json();a.success&&(D(a.data.data),Y(a.data.total),H(a.data.page))}else w.ZP.error(a.err_msg||"failed")}else if("file"===_){if(!M){w.ZP.error("Please select a file");return}let e=new FormData;e.append("doc_name",R),e.append("doc_file",M),e.append("doc_type","DOCUMENT");let a=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/upload"),{method:"POST",body:e}),n=await a.json();if(n.success){w.ZP.success("success"),m(!1);let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:A,page_size:20})}),a=await e.json();a.success&&(D(a.data.data),Y(a.data.total),H(a.data.page))}else w.ZP.error(n.err_msg||"failed")}else{if(""===W){w.ZP.error("Please input the text");return}let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/add"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doc_name:R,source:L,content:W,doc_type:"TEXT"})}),a=await e.json();if(a.success){w.ZP.success("success"),m(!1);let e=await fetch("".concat(P.S,"/knowledge/").concat(t,"/document/list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:A,page_size:20})}),a=await e.json();a.success&&(D(a.data.data),Y(a.data.total),H(a.data.page))}else w.ZP.error(a.err_msg||"failed")}},children:"Finish"})]})]})})]})}}},function(e){e.O(0,[550,448,22,599,86,952,261,777,434,611,253,769,744],function(){return e(e.s=22199)}),_N_E=e.O()}]);