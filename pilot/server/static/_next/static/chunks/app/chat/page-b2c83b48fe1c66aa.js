(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{55749:function(e,t,r){"use strict";var a=r(78997);t.Z=void 0;var n=a(r(76906)),i=r(9268),s=(0,n.default)([(0,i.jsx)("path",{d:"M19.89 10.75c.07.41.11.82.11 1.25 0 4.41-3.59 8-8 8s-8-3.59-8-8c0-.05.01-.1 0-.14 2.6-.98 4.69-2.99 5.74-5.55 3.38 4.14 7.97 3.73 8.99 3.61l-.89-1.93c-.13.01-4.62.38-7.18-3.86 1.01-.16 1.71-.15 2.59-.01 2.52-1.15 1.93-.89 2.76-1.26C14.78 2.3 13.43 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-1.43-.3-2.78-.84-4.01l-1.27 2.76zM8.08 5.03C7.45 6.92 6.13 8.5 4.42 9.47 5.05 7.58 6.37 6 8.08 5.03z"},"0"),(0,i.jsx)("circle",{cx:"15",cy:"13",r:"1.25"},"1"),(0,i.jsx)("circle",{cx:"9",cy:"13",r:"1.25"},"2"),(0,i.jsx)("path",{d:"m23 4.5-2.4-1.1L19.5 1l-1.1 2.4L16 4.5l2.4 1.1L19.5 8l1.1-2.4z"},"3")],"FaceRetouchingNaturalOutlined");t.Z=s},70781:function(e,t,r){"use strict";var a=r(78997);t.Z=void 0;var n=a(r(76906)),i=r(9268),s=(0,n.default)((0,i.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zm-2 10H6V7h12v12zm-9-6c-.83 0-1.5-.67-1.5-1.5S8.17 10 9 10s1.5.67 1.5 1.5S9.83 13 9 13zm7.5-1.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5zM8 15h8v2H8v-2z"}),"SmartToyOutlined");t.Z=s},90545:function(e,t,r){"use strict";r.d(t,{Z:function(){return g}});var a=r(40431),n=r(46750),i=r(86006),s=r(89791),o=r(4323),l=r(51579),c=r(86601),u=r(95887),d=r(9268);let h=["className","component"];var f=r(47327),v=r(98918);let m=function(e={}){let{themeId:t,defaultTheme:r,defaultClassName:f="MuiBox-root",generateClassName:v}=e,m=(0,o.ZP)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(l.Z),g=i.forwardRef(function(e,i){let o=(0,u.Z)(r),l=(0,c.Z)(e),{className:g,component:p="div"}=l,x=(0,n.Z)(l,h);return(0,d.jsx)(m,(0,a.Z)({as:p,ref:i,className:(0,s.Z)(g,v?v(f):f),theme:t&&o[t]||o},x))});return g}({defaultTheme:v.Z,defaultClassName:"MuiBox-root",generateClassName:f.Z.generate});var g=m},84380:function(e,t,r){Promise.resolve().then(r.bind(r,59498))},59498:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(9268),n=r(89081),i=r(78915),s=r(66487),o=r(67830),l=r(54842),c=r(78635),u=r(70900),d=r(62414),h=r(90545),f=r(94244),v=r(33155),m=r(7354),g=r(35086),p=r(53047),x=r(86006),y=r(19700),j=r(92391),w=r(55749),Z=r(70781),b=r(75403),S=r(99398),P=r(49064),N=r(56008);let C=j.z.object({query:j.z.string().min(1)});var O=e=>{var t;let{messages:r,onSubmit:n,readOnly:i,paramsList:s,clearIntialMessage:j}=e,{mode:O}=(0,c.tv)(),R=(0,N.useSearchParams)(),k=R.get("initMessage"),z=x.useRef(null),[_,E]=(0,x.useState)(!1),[M,L]=(0,x.useState)(),T=(0,y.cI)({resolver:(0,o.F)(C),defaultValues:{}}),D=async e=>{let{query:t}=e;try{console.log("submit"),E(!0),T.reset(),await n(t,{select_param:null==s?void 0:s[M]})}catch(e){}finally{E(!1)}},F=async()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("initMessage");e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString())),await D({query:t})}catch(e){console.log(e)}finally{null==j||j()}},H={overrides:{code:e=>{let{children:t}=e;return(0,a.jsx)(S.Z,{language:"javascript",style:P.Z,children:t})}}};return x.useEffect(()=>{z.current&&z.current.scrollTo(0,z.current.scrollHeight)},[null==r?void 0:r.length]),x.useEffect(()=>{k&&r.length<=0&&F()},[k,r.length]),x.useEffect(()=>{var e,t;s&&(null===(e=Object.keys(s||{}))||void 0===e?void 0:e.length)>0&&L(null===(t=Object.keys(s||{}))||void 0===t?void 0:t[0])},[s]),(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsxs)(u.Z,{className:"w-full h-full",sx:{background:"light"===O?"#fefefe":"#212121",table:{borderCollapse:"collapse",border:"1px solid #ccc"},"th, td":{border:"1px solid #ccc",padding:"10px",textAlign:"center"}},children:[(0,a.jsxs)(u.Z,{ref:z,direction:"column",sx:{overflowY:"auto",maxHeight:"100%",flex:1},children:[null===(t=r.filter(e=>["view","human"].includes(e.role)))||void 0===t?void 0:t.map((e,t)=>{var r;return(0,a.jsx)(u.Z,{children:(0,a.jsx)(d.Z,{size:"sm",variant:"outlined",color:"view"===e.role?"primary":"neutral",sx:t=>({background:"view"===e.role?"var(--joy-palette-primary-softBg, var(--joy-palette-primary-100, #DDF1FF))":"unset",border:"unset",borderRadius:"unset",padding:"24px 0 26px 0",lineHeight:"24px"}),children:(0,a.jsxs)(h.Z,{sx:{width:"76%",margin:"0 auto"},className:"flex flex-row",children:[(0,a.jsx)("div",{className:"mr-3 inline",children:"view"===e.role?(0,a.jsx)(Z.Z,{}):(0,a.jsx)(w.Z,{})}),(0,a.jsx)("div",{className:"inline align-middle mt-0.5",children:(0,a.jsx)(b.Z,{options:H,children:null===(r=e.context)||void 0===r?void 0:r.replaceAll("\\n","\n")})})]})})},t)}),_&&(0,a.jsx)(f.Z,{variant:"soft",color:"neutral",size:"sm",sx:{mx:"auto",my:2}})]}),!i&&(0,a.jsx)(h.Z,{sx:{position:"relative",background:"light"===O?"#fefefe":"#212121","&::before":{content:'" "',position:"absolute",top:"-18px",left:"0",right:"0",width:"100%",margin:"0 auto",height:"20px",background:"light"===O?"#fefefe":"#212121",filter:"blur(10px)",zIndex:2}},children:(0,a.jsxs)("form",{style:{maxWidth:"100%",width:"76%",position:"relative",display:"flex",marginTop:"auto",overflow:"visible",background:"none",justifyContent:"center",marginLeft:"auto",marginRight:"auto",flexDirection:"column",gap:"12px",paddingBottom:"58px",paddingTop:"20px"},onSubmit:e=>{e.stopPropagation(),T.handleSubmit(D)(e)},children:[Object.keys(s||{}).length>0&&(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)(v.Z,{value:M,onChange:(e,t)=>{L(t)},sx:{maxWidth:"100%"},children:Object.keys(s||{}).map(e=>(0,a.jsx)(m.Z,{value:e,children:e},e))})}),(0,a.jsx)(g.ZP,{className:"w-full h-12",variant:"outlined",endDecorator:(0,a.jsx)(p.ZP,{type:"submit",disabled:_,children:(0,a.jsx)(l.Z,{})}),...T.register("query")})]})})]})})},R=r(57931),k=()=>{let e=(0,N.useSearchParams)(),{refreshDialogList:t}=(0,R.Cg)(),r=e.get("id"),o=e.get("scene"),{data:l}=(0,n.Z)(async()=>await (0,i.T)("/v1/chat/dialogue/messages/history",{con_uid:r}),{ready:!!r,refreshDeps:[r]}),{data:c}=(0,n.Z)(async()=>await (0,i.K)("/v1/chat/mode/params/list?chat_mode=".concat(o)),{ready:!!o,refreshDeps:[o]}),{history:u,handleChatSubmit:d}=(0,s.Z)({queryAgentURL:"/v1/chat/completions",queryBody:{conv_uid:r,chat_mode:o||"chat_normal"},initHistory:null==l?void 0:l.data});return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(O,{clearIntialMessage:async()=>{await t()},messages:u||[],onSubmit:d,paramsList:null==c?void 0:c.data})})}},57931:function(e,t,r){"use strict";r.d(t,{ZP:function(){return c},Cg:function(){return o}});var a=r(9268),n=r(89081),i=r(78915),s=r(86006);let[o,l]=function(){let e=s.createContext(void 0);return[function(){let t=s.useContext(e);if(void 0===t)throw Error("useCtx must be inside a Provider with a value");return t},e.Provider]}();var c=e=>{let{children:t}=e,{run:r,data:s,refresh:o}=(0,n.Z)(async()=>await (0,i.T)("/v1/chat/dialogue/list"),{manual:!0});return(0,a.jsx)(l,{value:{dialogueList:s,queryDialogueList:r,refreshDialogList:o},children:t})}},66487:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(71990),n=r(86006),i=e=>{let t=(0,n.useReducer)((e,t)=>({...e,...t}),{...e});return t},s=r(57931),o=e=>{let{queryAgentURL:t,channel:r,queryBody:o,initHistory:l}=e,[c,u]=i({history:l||[]}),{refreshDialogList:d}=(0,s.Cg)();(0,n.useEffect)(()=>{l&&u({history:l})},[l]);let h=async(e,n)=>{if(!e)return;let i=[...c.history,{role:"human",context:e}],s=i.length;u({history:i});try{let l=new AbortController;await (0,a.L)("".concat("http://127.0.0.1:5000/api"+t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,...o,user_input:e,channel:r}),signal:l.signal,async onopen(e){if(i.length<=1){d();let e=new URLSearchParams(window.location.search);e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString()))}(!e.ok||e.headers.get("content-type")!==a.a)&&e.status>=400&&e.status<500&&429!==e.status&&e.status},onclose(){console.log("onclose")},onerror(e){throw Error(e)},onmessage:e=>{var t;if(console.log(e,"e"),e.data=e.data.replaceAll("\\n","\n"),"[DONE]"===e.data)l.abort();else if(null===(t=e.data)||void 0===t?void 0:t.startsWith("[ERROR]"))l.abort(),u({history:[...i,{role:"view",context:e.data.replace("[ERROR]","")}]});else{let t=[...i];e.data&&((null==t?void 0:t[s])?t[s].context="".concat(e.data):t.push({role:"view",context:e.data}),u({history:t}))}}})}catch(e){console.log("---e",e),u({history:[...i,{role:"view",context:"请求出错"}]})}};return{handleChatSubmit:h,history:c.history}}},78915:function(e,t,r){"use strict";r.d(t,{T:function(){return c},K:function(){return u}});var a=r(21628),n=r(24214);let i=n.Z.create({baseURL:"http://127.0.0.1:5000"});i.defaults.timeout=1e4,i.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var s=r(84835);let o={"content-type":"application/json"},l=e=>{if(!(0,s.isPlainObject)(e))return JSON.stringify(e);let t={...e};for(let e in t){let r=t[e];"string"==typeof r&&(t[e]=r.trim())}return JSON.stringify(t)},c=(e,t)=>{if(t){let r=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");r&&(e+="?".concat(r))}return i.get("/api"+e,{headers:o}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},u=(e,t)=>{let r=l(t);return i.post("/api"+e,{body:r,headers:o}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})}}},function(e){e.O(0,[180,430,577,599,86,562,259,751,662,253,769,744],function(){return e(e.s=84380)}),_N_E=e.O()}]);