(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1929],{86066:function(e,l,t){Promise.resolve().then(t.bind(t,48110))},48110:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return ev}});var n=t(9268),i=t(86006),a=t(57931),d=t(44972),o=t(89081),r=t(83192),s=t(35891),u=t(22046),c=t(71451),v=t(24857),h=t(53113),x=t(90545),f=t(48755),m=t(1777),p=t(76447),j=t(61469),g=t(57746);function b(){}function y(e){let{width:l="100%",height:a="100%",value:d,defaultValue:o,language:r,theme:s,options:u,overrideServices:c,editorWillMount:v,editorDidMount:h,editorWillUnmount:x,className:f,description:m,uri:p,editorInstanceRef:j,handleChange:g}=e,b=i.useMemo(()=>{if("function"==typeof(null==window?void 0:window.fetch)){let e=t(12116);return e}},[]),y=(0,i.useRef)(null),_=(0,i.useRef)(null),w=(0,i.useRef)(null),Z=(0,i.useRef)(null),N=i.useMemo(()=>({width:l,height:a,overflow:"hidden"}),[l,a]),S=()=>{let e=null==v?void 0:v(b);return e||{}},P=()=>{if(!(null==_?void 0:_.current)){console.error("Can not get editor element!");return}if(null==h||h(null==_?void 0:_.current,b),null==j||j(null==_?void 0:_.current),w){var e,l;w.current=null==_?void 0:null===(e=_.current)||void 0===e?void 0:null===(l=e.onDidChangeModelContent)||void 0===l?void 0:l.call(e,e=>{if(!Z.current){var l,t,n,i;let e=null==_?void 0:null===(l=_.current)||void 0===l?void 0:l.getModel(),a=null==_?void 0:null===(t=_.current)||void 0===t?void 0:t.getVisibleRanges(),d=null==e?void 0:e.getDecorationsInRange(null==a?void 0:a[0]);if(d){let l;for(let e=0;e<(null==d?void 0:d.length);e++){let t=d[e],n=t.options;n&&"my-description"===n.className&&(l=t)}if(l){let t=null==e?void 0:e.getValueInRange(new b.Range(l.range.startLineNumber,1,l.range.endLineNumber+1,1)),n=null==e?void 0:e.getLinesContent(),i=null==n?void 0:n.slice(l.range.endLineNumber);g(null==i?void 0:i.join("\n"),t);return}}null==g||g(null==_?void 0:null===(n=_.current)||void 0===n?void 0:null===(i=n.getValue)||void 0===i?void 0:i.call(n),void 0)}})}},k=()=>{if(!(null==_?void 0:_.current)){console.error("Can not get editor element!");return}null==x||x(null==_?void 0:_.current,b)};return(0,i.useEffect)(()=>{let e=null!==d?d:o;if(y.current){let l={...u,...S()},t=null==p?void 0:p(b),n=t&&b.editor.getModel(t);n?(n.setValue(e),b.editor.setModelLanguage(n,r)):n=b.editor.createModel(e,r,t),_.current=b.editor.create(y.current,{model:n,...f?{extraEditorClassName:f}:{},...l,...s?{theme:s}:{},automaticLayout:!0},c),P()}},[]),(0,i.useEffect)(()=>{if(_.current){var e;let l=_.current.getModel();Z.current=!0,_.current.pushUndoStop(),null==l||l.pushEditOperations([],[{range:null==l?void 0:l.getFullModelRange(),text:"\n".concat(m?"-- "+m:"","\n\n")+d}],void 0);let t=null==_?void 0:null===(e=_.current)||void 0===e?void 0:e.getVisibleRanges(),n=null==l?void 0:l.getDecorationsInRange(null==t?void 0:t[0]),i=[];null==n||n.forEach(e=>{var l;(null==e?void 0:null===(l=e.options)||void 0===l?void 0:l.className)==="my-description"&&i.push(e.id)}),null==l||l.deltaDecorations(i,[{range:new b.Range(1,1,3,1),options:{before:{content:"-- 注释开始"},after:{content:"-- 注释结束"},className:"my-description"}}]),_.current.pushUndoStop(),Z.current=!1}},[d,m]),(0,i.useEffect)(()=>{if(_.current){let e=_.current.getModel();b.editor.setModelLanguage(e,r)}},[r]),(0,i.useEffect)(()=>{if(_.current){let{model:e,...l}=u;_.current.updateOptions({...f?{extraEditorClassName:f}:{},...l,wordWrap:"on"})}},[f,u]),(0,i.useEffect)(()=>{b.editor.setTheme(s)},[s]),(0,i.useEffect)(()=>()=>{if(_.current){k(),_.current.dispose();let e=_.current.getModel();e&&e.dispose()}w.current&&w.current.dispose()},[]),(0,n.jsx)("div",{ref:y,className:"react-monaco-editor-container",style:N})}y.defaultProps={value:null,defaultValue:"",language:"javascript",theme:null,options:{},overrideServices:{},editorWillMount:b,editorDidMount:b,editorWillUnmount:b,onChange:b,className:null},y.displayName="MonacoEditor";var _=t(78915),w=t(56008),Z=t(90022),N=t(8997),S=t(91440),P=t(84835),k=t.n(P),C=function(e){let{type:l,values:t,title:a,description:d}=e,o=i.useMemo(()=>{if(!((null==t?void 0:t.length)>0))return(0,n.jsx)("div",{className:"h-full",children:(0,n.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:"图表数据为空"})});if("IndicatorValue"!==l){if("Table"===l){var e,i,a;let l=k().groupBy(t,"type");return(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsxs)(r.Z,{"aria-label":"basic table",hoverRow:!0,stickyHeader:!0,children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:Object.keys(l).map(e=>(0,n.jsx)("th",{children:e},e))})}),(0,n.jsx)("tbody",{children:null===(e=Object.values(l))||void 0===e?void 0:null===(i=e[0])||void 0===i?void 0:null===(a=i.map)||void 0===a?void 0:a.call(i,(e,t)=>{var i;return(0,n.jsx)("tr",{children:null===(i=Object.keys(l))||void 0===i?void 0:i.map(e=>{var i;return(0,n.jsx)("td",{children:(null==l?void 0:null===(i=l[e])||void 0===i?void 0:i[t].value)||""},e)})},t)})})]})})}return"BarChart"===l?(0,n.jsx)("div",{className:"flex-1 h-full",children:(0,n.jsxs)(S.Chart,{autoFit:!0,data:t||[],forceUpdate:!0,children:[(0,n.jsx)(S.Interval,{position:"name*value",style:{lineWidth:3,stroke:(0,S.getTheme)().colors10[0]}}),(0,n.jsx)(S.Tooltip,{shared:!0})]})}):"LineChart"===l?(0,n.jsx)("div",{className:"flex-1 h-full",children:(0,n.jsx)(S.Chart,{forceUpdate:!0,autoFit:!0,data:t||[],children:(0,n.jsx)(S.LineAdvance,{shape:"smooth",point:!0,area:!0,position:"name*value",color:"type"})})}):(0,n.jsx)("div",{className:"h-full",children:(0,n.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:"暂不支持该图表类型"})})}},[t,l]);return"IndicatorValue"===l&&(null==t?void 0:t.length)>0?(0,n.jsx)("div",{className:"flex flex-row gap-3",children:t.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(Z.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"justify-around",children:[(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(u.ZP,{children:"".concat(e.type,": ").concat(e.value)})]})})},e.name))}):(0,n.jsx)("div",{className:"flex-1 h-full",children:(0,n.jsx)(Z.Z,{className:"h-full overflow-auto",sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"h-full",children:[a&&(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:a}),d&&(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",children:d}),o]})})})};let{Search:E}=m.default;function R(e){var l,t,a;let{editorValue:d,chartData:o,tableData:s,handleChange:u}=e,c=i.useMemo(()=>o?(0,n.jsx)("div",{className:"flex-1 overflow-auto p-3",style:{flexShrink:0,overflow:"hidden"},children:(0,n.jsx)(C,{...o})}):(0,n.jsx)("div",{}),[o]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,n.jsx)("div",{className:"flex-1",style:{flexShrink:0,overflow:"auto"},children:(0,n.jsx)(y,{value:null==d?void 0:d.sql,language:"mysql",handleChange:u,description:null==d?void 0:d.thoughts})}),c]}),(0,n.jsx)("div",{className:"h-60 border-[var(--joy-palette-divider)] border-t border-solid overflow-auto",children:(null==s?void 0:null===(l=s.values)||void 0===l?void 0:l.length)>0?(0,n.jsxs)(r.Z,{"aria-label":"basic table",stickyHeader:!0,children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:null==s?void 0:null===(t=s.columns)||void 0===t?void 0:t.map((e,l)=>(0,n.jsx)("th",{children:e},e+l))})}),(0,n.jsx)("tbody",{children:null==s?void 0:null===(a=s.values)||void 0===a?void 0:a.map((e,l)=>{var t;return(0,n.jsx)("tr",{children:null===(t=Object.keys(e))||void 0===t?void 0:t.map(l=>(0,n.jsx)("td",{children:e[l]},l))},l)})})]}):(0,n.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,n.jsx)(p.Z,{})})})]})}var D=function(){var e,l,t,a,d;let[r,m]=i.useState([]),[p,b]=i.useState(""),[y,Z]=i.useState(),[N,S]=i.useState(!0),[P,k]=i.useState(),[C,D]=i.useState(),[O,M]=i.useState(),[q,L]=i.useState(),[T,B]=i.useState(),I=(0,w.useSearchParams)(),A=I.get("id"),V=I.get("scene"),{data:F,loading:z}=(0,o.Z)(async()=>await (0,_.Tk)("/v1/editor/sql/rounds",{con_uid:A}),{onSuccess:e=>{var l,t;let n=null==e?void 0:null===(l=e.data)||void 0===l?void 0:l[(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.length)-1];n&&Z(null==n?void 0:n.round)}}),{run:U,loading:J}=(0,o.Z)(async()=>{var e,l;let t=null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name;return await (0,_.PR)("/api/v1/editor/sql/run",{db_name:t,sql:null==O?void 0:O.sql})},{manual:!0,onSuccess:e=>{var l,t;L({columns:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.colunms,values:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.values})}}),{run:W,loading:H}=(0,o.Z)(async()=>{var e,l;let t=null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name,n={db_name:t,sql:null==O?void 0:O.sql};return"chat_dashboard"===V&&(n.chart_type=null==O?void 0:O.showcase),await (0,_.PR)("/api/v1/editor/chart/run",n)},{manual:!0,ready:!!(null==O?void 0:O.sql),onSuccess:e=>{if(null==e?void 0:e.success){var l,t,n,i,a,d,o;L({columns:(null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(t=l.sql_data)||void 0===t?void 0:t.colunms)||[],values:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(i=n.sql_data)||void 0===i?void 0:i.values)||[]}),(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.chart_values)?k({type:null==e?void 0:null===(d=e.data)||void 0===d?void 0:d.chart_type,values:null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.chart_values,title:null==O?void 0:O.title,description:null==O?void 0:O.thoughts}):k(void 0)}}}),{run:G,loading:K}=(0,o.Z)(async()=>{var e,l,t,n,i;let a=null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name;return await (0,_.PR)("/api/v1/sql/editor/submit",{conv_uid:A,db_name:a,conv_round:y,old_sql:null==C?void 0:C.sql,old_speak:null==C?void 0:C.thoughts,new_sql:null==O?void 0:O.sql,new_speak:(null===(t=null==O?void 0:null===(n=O.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===t?void 0:null===(i=t[1])||void 0===i?void 0:i.trim())||(null==O?void 0:O.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&U()}}),{run:Y,loading:$}=(0,o.Z)(async()=>{var e,l,t,n,i,a;let d=null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name;return await (0,_.PR)("/api/v1/chart/editor/submit",{conv_uid:A,chart_title:null==O?void 0:O.title,db_name:d,old_sql:null==C?void 0:null===(t=C[T])||void 0===t?void 0:t.sql,new_chart_type:null==O?void 0:O.showcase,new_sql:null==O?void 0:O.sql,new_comment:(null===(n=null==O?void 0:null===(i=O.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(a=n[1])||void 0===a?void 0:a.trim())||(null==O?void 0:O.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&W()}}),{data:Q}=(0,o.Z)(async()=>{var e,l;let t=null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name;return await (0,_.Tk)("/v1/editor/db/tables",{db_name:t,page_index:1,page_size:200})},{ready:!!(null===(e=null==F?void 0:null===(l=F.data)||void 0===l?void 0:l.find(e=>e.round===y))||void 0===e?void 0:e.db_name),refreshDeps:[null===(t=null==F?void 0:null===(a=F.data)||void 0===a?void 0:a.find(e=>e.round===y))||void 0===t?void 0:t.db_name]}),{run:X}=(0,o.Z)(async e=>await (0,_.Tk)("/v1/editor/sql",{con_uid:A,round:e}),{manual:!0,onSuccess:e=>{let l;try{if(Array.isArray(null==e?void 0:e.data))l=null==e?void 0:e.data,B("0");else if("string"==typeof(null==e?void 0:e.data)){let t=JSON.parse(null==e?void 0:e.data);l=t}else l=null==e?void 0:e.data}catch(e){console.log(e)}finally{D(l),Array.isArray(l)?M(null==l?void 0:l[Number(T||0)]):M(l)}}}),ee=i.useMemo(()=>{let e=(l,t)=>l.map(l=>{let i=l.title,a=i.indexOf(p),d=i.substring(0,a),o=i.slice(a+p.length),r=a>-1?(0,n.jsx)(s.Z,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("span",{children:[d,(0,n.jsx)("span",{className:"text-[#1677ff]",children:p}),o,(null==l?void 0:l.type)&&(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",className:"inline pl-0.5",children:"[".concat(null==l?void 0:l.type,"]")})]})}):(0,n.jsx)(s.Z,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("span",{children:[i,(null==l?void 0:l.type)&&(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",className:"inline pl-0.5",children:"[".concat(null==l?void 0:l.type,"]")})]})});if(l.children){let n=t?String(t)+"_"+l.key:l.key;return{title:i,showTitle:r,key:n,children:e(l.children,n)}}return{title:i,showTitle:r,key:l.key}});return(null==Q?void 0:Q.data)?e([null==Q?void 0:Q.data]):[]},[p,Q]),el=i.useMemo(()=>{let e=[],l=(t,n)=>{if(t&&!((null==t?void 0:t.length)<=0))for(let i=0;i<t.length;i++){let a=t[i],{key:d,title:o}=a;e.push({key:d,title:o,parentKey:n}),a.children&&l(a.children,d)}};return ee&&l(ee),e},[ee]),et=(e,l)=>{let t;for(let n=0;n<l.length;n++){let i=l[n];i.children&&(i.children.some(l=>l.key===e)?t=i.key:et(e,i.children)&&(t=et(e,i.children)))}return t};return i.useEffect(()=>{y&&X(y)},[X,y]),i.useEffect(()=>{C&&"chat_dashboard"===V&&T&&W()},[T,V,C,W]),i.useEffect(()=>{C&&"chat_dashboard"!==V&&U()},[V,C,U]),(0,n.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,n.jsxs)("div",{className:"bg-[#f8f8f8] border-[var(--joy-palette-divider)] border-b border-solid flex items-center px-3 justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center py-3",children:[(0,n.jsx)(f.Z,{className:"mr-2"}),(0,n.jsx)(c.Z,{className:"h-4 min-w-[240px]",size:"sm",value:y,onChange:(e,l)=>{Z(l)},children:null==F?void 0:null===(d=F.data)||void 0===d?void 0:d.map(e=>(0,n.jsx)(v.Z,{value:null==e?void 0:e.round,children:null==e?void 0:e.round_name},null==e?void 0:e.round))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(h.Z,{className:"bg-[#1677ff] text-[#fff] hover:bg-[#1c558e]",loading:J||H,onClick:async()=>{"chat_dashboard"===V?W():U()},children:"Run"}),(0,n.jsx)(h.Z,{variant:"outlined",className:"ml-3",loading:K||$,onClick:async()=>{"chat_dashboard"===V?await Y():await G()},children:"Save"})]})]}),(0,n.jsxs)("div",{className:"flex flex-1 overflow-auto",children:[(0,n.jsxs)("div",{className:"text h-full border-[var(--joy-palette-divider)] border-r border-solid p-3 max-h-full overflow-auto",style:{width:"300px"},children:[(0,n.jsx)(E,{style:{marginBottom:8},placeholder:"Search",onChange:e=>{let{value:l}=e.target;if(null==Q?void 0:Q.data){if(l){let e=el.map(e=>e.title.indexOf(l)>-1?et(e.key,ee):null).filter((e,l,t)=>e&&t.indexOf(e)===l);m(e)}else m([]);b(l),S(!0)}}}),(0,n.jsx)(j.Z,{onExpand:e=>{m(e),S(!1)},expandedKeys:r,autoExpandParent:N,treeData:ee,fieldNames:{title:"showTitle"}})]}),(0,n.jsx)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:Array.isArray(C)?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(x.Z,{className:"h-full",sx:{".ant-tabs-content, .ant-tabs-tabpane-active":{height:"100%"},"& .ant-tabs-card.ant-tabs-top >.ant-tabs-nav .ant-tabs-tab, & .ant-tabs-card.ant-tabs-top >div>.ant-tabs-nav .ant-tabs-tab":{borderRadius:"0"}},children:(0,n.jsx)(g.Z,{className:"h-full",type:"card",activeKey:T,onChange:e=>{B(e),M(null==C?void 0:C[Number(e)])},items:null==C?void 0:C.map((e,l)=>({key:l+"",label:null==e?void 0:e.title,children:(0,n.jsx)("div",{className:"flex flex-col h-full",children:(0,n.jsx)(R,{editorValue:e,handleChange:(e,l)=>{if(O){let t=JSON.parse(JSON.stringify(O));t.sql=e,t.thoughts=l,M(t)}},tableData:q,chartData:P})})}))})})}):(0,n.jsx)(R,{editorValue:C,handleChange:(e,l)=>{M({thoughts:l,sql:e})},tableData:q,chartData:void 0})})]})]})},O=t(69962),M=t(97287),q=t(73141),L=t(45642),T=t(71990),B=e=>{let l=(0,i.useReducer)((e,l)=>({...e,...l}),{...e});return l},I=t(21628),A=t(52040),V=e=>{let{queryAgentURL:l,channel:t,queryBody:n,initHistory:d,runHistoryList:o}=e,[r,s]=B({history:d||[]}),u=(0,w.useSearchParams)(),c=u.get("id"),{refreshDialogList:v}=(0,a.Cg)(),h=new AbortController;(0,i.useEffect)(()=>{d&&s({history:d})},[d]);let x=async(e,i)=>{if(!e)return;let a=[...r.history,{role:"human",context:e}],d=a.length;s({history:a});let o={conv_uid:c,...i,...n,user_input:e,channel:t};if(!(null==o?void 0:o.conv_uid)){I.ZP.error("conv_uid 不存在，请刷新后重试");return}try{await (0,T.L)("".concat(A.env.API_BASE_URL?A.env.API_BASE_URL:"").concat("/api"+l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:h.signal,async onopen(e){if(a.length<=1){var l;v();let e=new URLSearchParams(window.location.search);e.delete("initMessage"),null===(l=window.history)||void 0===l||l.replaceState(null,null,"?".concat(e.toString()))}(!e.ok||e.headers.get("content-type")!==T.a)&&e.status>=400&&e.status<500&&429!==e.status&&e.status},onclose(){console.log("onclose")},onerror(e){throw console.log("onerror"),Error(e)},onmessage:e=>{var l,t,n;if(e.data=null===(l=e.data)||void 0===l?void 0:l.replaceAll("\\n","\n"),"[DONE]"===e.data);else if(null===(t=e.data)||void 0===t?void 0:t.startsWith("[ERROR]"))s({history:[...a,{role:"view",context:null===(n=e.data)||void 0===n?void 0:n.replace("[ERROR]","")}]});else{let l=[...a];e.data&&((null==l?void 0:l[d])?l[d].context="".concat(e.data):l.push({role:"view",context:e.data}),s({history:l}))}}})}catch(e){console.log(e),s({history:[...a,{role:"view",context:"请求出错"}]})}};return{handleChatSubmit:x,history:r.history}},F=t(67830),z=t(54842),U=t(80937),J=t(311),W=t(94244),H=t(35086),G=t(53047),K=t(34112),Y=t(30530),$=t(64747),Q=t(77614),X=t(19700),ee=t(92391),el=t(55749),et=t(70781),en=t(42599),ei=t(99398),ea=t(49064),ed=t(15241),eo=t(28179);let er=ee.z.object({query:ee.z.string().min(1)});var es=e=>{var l;let{messages:a,onSubmit:d,readOnly:o,paramsList:s,runParamsList:u,dbList:f,runDbList:m,supportTypes:p,clearIntialMessage:j,setChartsData:g}=e,b=(0,w.useSearchParams)(),y=b.get("initMessage"),N=b.get("scene"),S="chat_dashboard"===N,P=(0,i.useRef)(null),[C,E]=(0,i.useState)(!1),[R,D]=(0,i.useState)(),[O,M]=(0,i.useState)(!1),[q,L]=(0,i.useState)(),[T,B]=(0,i.useState)(a),[A,V]=(0,i.useState)(""),[ee,es]=(0,i.useState)(!1),[eu,ec]=(0,i.useState)(f),ev=(e,l,t)=>{let n=k().cloneDeep(eu);n&&(void 0===(null==eu?void 0:eu[e])&&(n[e]={}),n[e][l]=t,ec(n))},eh=(0,X.cI)({resolver:(0,F.F)(er),defaultValues:{}}),ex=async e=>{let{query:l}=e;try{E(!0),eh.reset(),await d(l,{select_param:null==s?void 0:s[R]})}catch(e){}finally{E(!1)}},ef=async()=>{try{var e;let l=new URLSearchParams(window.location.search),t=l.get("initMessage");l.delete("initMessage"),null===(e=window.history)||void 0===e||e.replaceState(null,null,"?".concat(l.toString())),await ex({query:t})}catch(e){console.log(e)}finally{null==j||j()}},em={overrides:{code:e=>{let{children:l}=e;return(0,n.jsx)(ei.Z,{language:"javascript",style:ea.Z,children:l})}},wrapper:i.Fragment},ep=e=>{let l=e;try{l=JSON.parse(e)}catch(e){console.log(e)}return l},ej=i.useMemo(()=>{if("function"==typeof(null==window?void 0:window.fetch)){let e=t(62631);return t(25204),t(82372),e.default}},[]);return i.useEffect(()=>{P.current&&P.current.scrollTo(0,P.current.scrollHeight)},[null==a?void 0:a.length]),i.useEffect(()=>{y&&a.length<=0&&ef()},[y,a.length]),i.useEffect(()=>{var e,l;s&&(null===(e=Object.keys(s||{}))||void 0===e?void 0:e.length)>0&&D(null===(l=Object.keys(s||{}))||void 0===l?void 0:l[0])},[s]),i.useEffect(()=>{if(S){let e=k().cloneDeep(a);e.forEach(e=>{(null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context)&&(e.context=ep(null==e?void 0:e.context))}),B(e.filter(e=>["view","human"].includes(e.role)))}else B(a.filter(e=>["view","human"].includes(e.role)))},[S,a]),(0,i.useEffect)(()=>{let e=k().cloneDeep(f);null==e||e.forEach(e=>{let l=null==p?void 0:p.find(l=>l.db_type===e.db_type);e.isfileDb=null==l?void 0:l.is_file_db}),ec(e)},[f,p]),(0,n.jsxs)("div",{className:"w-full h-full",children:[(0,n.jsxs)(U.Z,{className:"w-full h-full bg-[#fefefe] dark:bg-[#212121]",sx:{table:{borderCollapse:"collapse",border:"1px solid #ccc",width:"100%"},"th, td":{border:"1px solid #ccc",padding:"10px",textAlign:"center"}},children:[(0,n.jsxs)(U.Z,{ref:P,direction:"column",sx:{overflowY:"auto",maxHeight:"100%",flex:1},children:[null==T?void 0:T.map((e,l)=>{var t,i;return(0,n.jsx)(U.Z,{children:(0,n.jsx)(Z.Z,{size:"sm",variant:"outlined",color:"view"===e.role?"primary":"neutral",sx:l=>({background:"view"===e.role?"var(--joy-palette-primary-softBg, var(--joy-palette-primary-100, #DDF1FF))":"unset",border:"unset",borderRadius:"unset",padding:"24px 0 26px 0",lineHeight:"24px"}),children:(0,n.jsxs)(x.Z,{sx:{width:"76%",margin:"0 auto"},className:"flex flex-row",children:[(0,n.jsx)("div",{className:"mr-3 inline",children:"view"===e.role?(0,n.jsx)(et.Z,{}):(0,n.jsx)(el.Z,{})}),(0,n.jsx)("div",{className:"inline align-middle mt-0.5 max-w-full flex-1 overflow-auto",children:S&&"view"===e.role&&"object"==typeof(null==e?void 0:e.context)?(0,n.jsxs)(n.Fragment,{children:["[".concat(e.context.template_name,"]: "),(0,n.jsx)(J.Z,{sx:{color:"#1677ff"},component:"button",onClick:()=>{M(!0),L(l),V(JSON.stringify(null==e?void 0:e.context,null,2))},children:e.context.template_introduce||"暂无介绍"})]}):(0,n.jsx)(n.Fragment,{children:"string"==typeof e.context&&(0,n.jsx)(en.Z,{options:em,children:null===(t=e.context)||void 0===t?void 0:null===(i=t.replaceAll)||void 0===i?void 0:i.call(t,"\\n","\n")})})})]})})},l)}),C&&(0,n.jsx)(W.Z,{variant:"soft",color:"neutral",size:"sm",sx:{mx:"auto",my:2}})]}),!o&&(0,n.jsx)(x.Z,{className:"bg-[#fefefe] dark:bg-[#212121] before:bg-[#fefefe] before:dark:bg-[#212121]",sx:{position:"relative","&::before":{content:'" "',position:"absolute",top:"-18px",left:"0",right:"0",width:"100%",margin:"0 auto",height:"20px",filter:"blur(10px)",zIndex:2}},children:(0,n.jsxs)("form",{style:{maxWidth:"100%",width:"76%",position:"relative",display:"flex",marginTop:"auto",overflow:"visible",background:"none",justifyContent:"center",marginLeft:"auto",marginRight:"auto",flexDirection:"column",gap:"12px",paddingBottom:"58px",paddingTop:"20px"},onSubmit:e=>{e.stopPropagation(),eh.handleSubmit(ex)(e)},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[Object.keys(s||{}).length>0&&(0,n.jsx)("div",{className:"flex items-center gap-3",children:(0,n.jsx)(c.Z,{value:R,onChange:(e,l)=>{D(l)},sx:{maxWidth:"100%"},children:null===(l=Object.keys(s||{}))||void 0===l?void 0:l.map(e=>(0,n.jsx)(v.Z,{value:e,children:e},e))})}),["chat_with_db_execute","chat_with_db_qa"].includes(N)&&(0,n.jsx)(h.Z,{"aria-label":"Like",variant:"plain",color:"neutral",sx:{padding:0,"&: hover":{backgroundColor:"unset"}},onClick:()=>{es(!0)},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(eo.Z,{style:{marginBottom:"0.125rem",fontSize:"28px"}}),(0,n.jsx)("span",{style:{display:"block",lineHeight:"25px",fontSize:12,marginLeft:6},children:"DB Connect Setting"})]})})]}),(0,n.jsx)(H.ZP,{className:"w-full h-12",variant:"outlined",endDecorator:(0,n.jsx)(G.ZP,{type:"submit",disabled:C,children:(0,n.jsx)(z.Z,{})}),...eh.register("query")})]})})]}),(0,n.jsx)(K.Z,{open:O,onClose:()=>{M(!1)},children:(0,n.jsxs)(Y.Z,{"aria-labelledby":"variant-modal-title","aria-describedby":"variant-modal-description",children:[(0,n.jsx)($.Z,{}),(0,n.jsxs)(x.Z,{sx:{marginTop:"32px"},children:[!!ej&&(0,n.jsx)(ej,{mode:"json",value:A,height:"600px",width:"820px",onChange:V,placeholder:"默认json数据",debounceChangePeriod:100,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,setOptions:{useWorker:!0,showLineNumbers:!0,highlightSelectedWord:!0,tabSize:2}}),(0,n.jsx)(h.Z,{variant:"outlined",className:"w-full",sx:{marginTop:"12px"},onClick:()=>{if(q)try{let e=k().cloneDeep(T),l=JSON.parse(A);e[q].context=l,B(e),null==g||g(null==l?void 0:l.charts),M(!1),V("")}catch(e){I.ZP.error("JSON 格式化出错")}},children:"Submit"})]})]})}),(0,n.jsx)(K.Z,{open:ee,onClose:()=>{es(!1),null==u||u()},children:(0,n.jsxs)(Y.Z,{children:[(0,n.jsx)($.Z,{}),(0,n.jsxs)(r.Z,{children:[(0,n.jsx)("caption",{children:(0,n.jsx)("h3",{style:{fontWeight:"bold"},children:"数据库列表"})}),(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"140px"},children:"数据库类型"}),(0,n.jsx)("th",{style:{width:"130px"},children:"数据库名"}),(0,n.jsx)("th",{style:{width:"150px"},children:"链接地址/域名"}),(0,n.jsx)("th",{style:{width:"100px"},children:"端口"}),(0,n.jsx)("th",{style:{width:"140px"},children:"用户名"}),(0,n.jsx)("th",{style:{width:"140px"},children:"密码"}),(0,n.jsx)("th",{style:{width:"140px"},children:"备注"}),(0,n.jsx)("th",{style:{width:"140px"},children:"操作"})]})}),(0,n.jsxs)("tbody",{children:[null==eu?void 0:eu.map((e,l)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(0,n.jsx)(c.Z,{defaultValue:null==e?void 0:e.db_type,onChange:(e,t)=>{let n=null==p?void 0:p.find(e=>e.db_type===t),i=k().cloneDeep(eu);i[l].db_type=t,i[l].isfileDb=null==n?void 0:n.is_file_db,n?(i[l].db_host="",i[l].db_port=""):i[l].db_path="",ec(i)},children:null==p?void 0:p.map(e=>(0,n.jsx)(v.Z,{value:e.db_type,children:null==e?void 0:e.db_type},e.db_type))}):(0,n.jsx)(ed.Z,{title:null==e?void 0:e.db_type,children:null==e?void 0:e.db_type})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isNew)?(0,n.jsx)(H.ZP,{value:null==e?void 0:e.db_name,onChange:e=>{ev(l,"db_name",e.target.value)}}):(0,n.jsx)(ed.Z,{title:null==e?void 0:e.db_name,children:null==e?void 0:e.db_name})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(0,n.jsx)(H.ZP,{value:(null==e?void 0:e.isfileDb)?null==e?void 0:e.db_path:null==e?void 0:e.db_host,onChange:t=>{(null==e?void 0:e.isfileDb)?ev(l,"db_path",t.target.value):ev(l,"db_host",t.target.value)}}):(0,n.jsx)(ed.Z,{title:(null==e?void 0:e.isfileDb)?null==e?void 0:e.db_path:null==e?void 0:e.db_host,children:(null==e?void 0:e.isfileDb)?null==e?void 0:e.db_path:null==e?void 0:e.db_host})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(null==e?void 0:e.isfileDb)?"-":(0,n.jsx)(H.ZP,{value:null==e?void 0:e.db_port,onChange:e=>{ev(l,"db_port",e.target.value)}}):(0,n.jsx)(ed.Z,{title:null==e?void 0:e.db_port,children:null==e?void 0:e.db_port})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(0,n.jsx)(H.ZP,{defaultValue:e.db_user,onChange:e=>{ev(l,"db_user",e.target.value)}}):(0,n.jsx)(ed.Z,{title:null==e?void 0:e.db_user,children:null==e?void 0:e.db_user})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(0,n.jsx)(H.ZP,{defaultValue:e.db_pwd,type:"password",onChange:e=>{ev(l,"db_pwd",e.target.value)}}):(0,n.jsx)(n.Fragment,{children:"******"})}),(0,n.jsx)("td",{children:(null==e?void 0:e.isEdit)?(0,n.jsx)(H.ZP,{defaultValue:null==e?void 0:e.comment,onChange:e=>{ev(l,"comment",e.target.value)}}):(0,n.jsx)(ed.Z,{title:null==e?void 0:e.comment,children:null==e?void 0:e.comment})}),(0,n.jsx)("td",{children:(0,n.jsxs)(x.Z,{sx:{gap:1,["& .".concat(Q.Z.root)]:{padding:0,"&:hover":{background:"transparent"}}},children:[(null==e?void 0:e.isEdit)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{size:"sm",variant:"plain",color:"neutral",sx:{marginRight:"8px"},onClick:async()=>{let l=k().cloneDeep(e),t={db_type:null==l?void 0:l.db_type,db_name:null==l?void 0:l.db_name,file_path:(null==l?void 0:l.isfileDb)?null==l?void 0:l.db_path:void 0,db_host:(null==l?void 0:l.isfileDb)?void 0:null==l?void 0:l.db_host,db_port:(null==l?void 0:l.isfileDb)?void 0:null==l?void 0:l.db_port,db_user:null==l?void 0:l.db_user,db_pwd:null==l?void 0:l.db_pwd,comment:null==l?void 0:l.comment};if(l.isNew){let e=null==f?void 0:f.map(e=>null==e?void 0:e.db_name);if(null==e?void 0:e.includes(null==l?void 0:l.db_name)){I.ZP.error("该数据库名称已存在");return}await (0,_.PR)("/api/v1/chat/db/add",t)}else await (0,_.PR)("/api/v1/chat/db/edit",t);await (null==m?void 0:m())},children:"保存"}),(0,n.jsx)(h.Z,{size:"sm",variant:"plain",color:"neutral",sx:{marginRight:"8px"},onClick:()=>{let t=k().cloneDeep(eu);(null==e?void 0:e.isNew)?t.splice(l,1):(t[l].isEdit=!1,t[l]=null==f?void 0:f[l]),ec(t)},children:"取消"})]}):(0,n.jsx)(h.Z,{size:"sm",variant:"plain",color:"neutral",sx:{marginRight:"8px"},onClick:()=>{let e=k().cloneDeep(eu);e[l].isEdit=!0,ec(e)},children:"编辑"}),(0,n.jsx)(h.Z,{size:"sm",variant:"soft",color:"danger",onClick:async()=>{(null==e?void 0:e.db_name)&&(await (0,_.PR)("/api/v1/chat/db/delete?db_name=".concat(null==e?void 0:e.db_name)),await (null==m?void 0:m()))},children:"删除"})]})})]},l)),(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:8,children:(0,n.jsx)(h.Z,{variant:"outlined",sx:{width:"100%"},onClick:()=>{let e=k().cloneDeep(eu);null==e||e.push({isEdit:!0,isNew:!0,db_name:""}),ec(e)},children:"+ 新增一行"})})})]})]})]})})]})};let eu=()=>(0,n.jsxs)(Z.Z,{className:"h-full w-full flex bg-transparent",children:[(0,n.jsx)(O.Z,{animation:"wave",variant:"text",level:"body2"}),(0,n.jsx)(O.Z,{animation:"wave",variant:"text",level:"body2"}),(0,n.jsx)(M.Z,{ratio:"21/9",className:"flex-1",sx:{["& .".concat(q.Z.content)]:{height:"100%"}},children:(0,n.jsx)(O.Z,{variant:"overlay",className:"h-full"})})]});var ec=()=>{let[e,l]=(0,i.useState)(),t=(0,w.useSearchParams)(),{refreshDialogList:d}=(0,a.Cg)(),s=t.get("id"),c=t.get("scene"),{data:v,run:h}=(0,o.Z)(async()=>await (0,_.Tk)("/v1/chat/dialogue/messages/history",{con_uid:s}),{ready:!!s,refreshDeps:[s,c]}),{data:f,run:m}=(0,o.Z)(async()=>await (0,_.Tk)("/v1/chat/db/list"),{ready:!!c&&!!["chat_with_db_execute","chat_with_db_qa"].includes(c)}),{data:p}=(0,o.Z)(async()=>await (0,_.Tk)("/v1/chat/db/support/type"),{ready:!!c&&!!["chat_with_db_execute","chat_with_db_qa"].includes(c)}),{data:j,run:g}=(0,o.Z)(async()=>await (0,_.Kw)("/v1/chat/mode/params/list?chat_mode=".concat(c)),{ready:!!c,refreshDeps:[s,c]}),{history:b,handleChatSubmit:y}=V({queryAgentURL:"/v1/chat/completions",queryBody:{conv_uid:s,chat_mode:c||"chat_normal"},initHistory:null==v?void 0:v.data,runHistoryList:h});(0,i.useEffect)(()=>{try{var e;let t=null==b?void 0:null===(e=b[b.length-1])||void 0===e?void 0:e.context,n=JSON.parse(t);l((null==n?void 0:n.template_name)==="report"?null==n?void 0:n.charts:void 0)}catch(e){l(void 0)}},[b]);let P=(0,i.useMemo)(()=>{if(e){let l=[],t=null==e?void 0:e.filter(e=>"IndicatorValue"===e.chart_type);t.length>0&&l.push({rowIndex:l.length,cols:t,type:"IndicatorValue"});let n=null==e?void 0:e.filter(e=>"IndicatorValue"!==e.chart_type),i=n.length,a=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][i].forEach(e=>{if(e>0){let t=n.slice(a,a+e);a+=e,l.push({rowIndex:l.length,cols:t})}}),l}},[e]);return(0,n.jsxs)(L.Z,{container:!0,spacing:2,className:"h-full overflow-auto px-3",sx:{flexGrow:1},children:[e&&(0,n.jsx)(L.Z,{xs:8,className:"max-h-full",children:(0,n.jsx)("div",{className:"flex flex-col gap-3 h-full",children:null==P?void 0:P.map(e=>(0,n.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex flex-1 gap-3 overflow-hidden":""),children:e.cols.map(e=>{if("IndicatorValue"===e.chart_type)return(0,n.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(Z.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"justify-around",children:[(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(u.ZP,{children:e.value})]})})},e.name))},e.chart_uid);if("LineChart"===e.chart_type)return(0,n.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,n.jsx)(Z.Z,{className:"h-full",sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"h-full",children:[(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:e.chart_name}),(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",children:e.chart_desc}),(0,n.jsx)("div",{className:"flex-1 h-full",children:(0,n.jsx)(S.Chart,{autoFit:!0,data:e.values,children:(0,n.jsx)(S.LineAdvance,{shape:"smooth",point:!0,area:!0,position:"name*value",color:"type"})})})]})})},e.chart_uid);if("BarChart"===e.chart_type)return(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(Z.Z,{className:"h-full",sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"h-full",children:[(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:e.chart_name}),(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",children:e.chart_desc}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(S.Chart,{autoFit:!0,data:e.values,children:[(0,n.jsx)(S.Interval,{position:"name*value",style:{lineWidth:3,stroke:(0,S.getTheme)().colors10[0]}}),(0,n.jsx)(S.Tooltip,{shared:!0})]})})]})})},e.chart_uid);if("Table"===e.chart_type){var l,t;let i=k().groupBy(e.values,"type");return(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(Z.Z,{className:"h-full overflow-auto",sx:{background:"transparent"},children:(0,n.jsxs)(N.Z,{className:"h-full",children:[(0,n.jsx)(u.ZP,{gutterBottom:!0,component:"div",children:e.chart_name}),(0,n.jsx)(u.ZP,{gutterBottom:!0,level:"body3",children:e.chart_desc}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(r.Z,{"aria-label":"basic table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:Object.keys(i).map(e=>(0,n.jsx)("th",{children:e},e))})}),(0,n.jsx)("tbody",{children:null===(l=Object.values(i))||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.map((e,l)=>{var t;return(0,n.jsx)("tr",{children:null===(t=Object.keys(i))||void 0===t?void 0:t.map(e=>{var t;return(0,n.jsx)("td",{children:(null==i?void 0:null===(t=i[e])||void 0===t?void 0:t[l].value)||""},e)})},l)})})]})})]})})},e.chart_uid)}})},e.rowIndex))})}),!e&&"chat_dashboard"===c&&(0,n.jsx)(L.Z,{xs:8,className:"max-h-full p-6",children:(0,n.jsx)("div",{className:"flex flex-col gap-3 h-full",children:(0,n.jsxs)(L.Z,{container:!0,spacing:2,sx:{flexGrow:1},children:[(0,n.jsx)(L.Z,{xs:8,children:(0,n.jsx)(x.Z,{className:"h-full w-full",sx:{display:"flex",gap:2},children:(0,n.jsx)(eu,{})})}),(0,n.jsx)(L.Z,{xs:4,children:(0,n.jsx)(eu,{})}),(0,n.jsx)(L.Z,{xs:4,children:(0,n.jsx)(eu,{})}),(0,n.jsx)(L.Z,{xs:8,children:(0,n.jsx)(eu,{})})]})})}),(0,n.jsx)(L.Z,{xs:"chat_dashboard"===c?4:12,className:"h-full max-h-full",children:(0,n.jsx)("div",{className:"h-full",style:{boxShadow:"chat_dashboard"===c?"0px 0px 9px 0px #c1c0c080":"unset"},children:(0,n.jsx)(es,{clearIntialMessage:async()=>{await d()},dbList:null==f?void 0:f.data,runDbList:m,supportTypes:null==p?void 0:p.data,messages:b||[],onSubmit:y,paramsList:null==j?void 0:j.data,runParamsList:g,setChartsData:l})})})]})},ev=()=>{let{isContract:e,setIsContract:l}=(0,a.Cg)(),t=(0,w.useSearchParams)(),i=t.get("scene"),o=i&&["chat_with_db_execute","chat_dashboard"].includes(i);return(0,n.jsxs)(n.Fragment,{children:[!e&&o&&(0,n.jsx)("div",{className:"leading-[3rem] text-right pr-3 mb-3 border-b flex justify-end",children:(0,n.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>{l(!e)},children:[(0,n.jsx)(d.Z,{style:{marginRight:"4px"}}),"Change Mode"]})}),e?(0,n.jsx)(D,{}):(0,n.jsx)(ec,{})]})}},57931:function(e,l,t){"use strict";t.d(l,{ZP:function(){return s},Cg:function(){return o}});var n=t(9268),i=t(89081),a=t(78915),d=t(86006);let[o,r]=function(){let e=d.createContext(void 0);return[function(){let l=d.useContext(e);if(void 0===l)throw Error("useCtx must be inside a Provider with a value");return l},e.Provider]}();var s=e=>{let{children:l}=e,[t,o]=d.useState(!1),{run:s,data:u,refresh:c}=(0,i.Z)(async()=>await (0,a.Tk)("/v1/chat/dialogue/list"),{manual:!0});return(0,n.jsx)(r,{value:{isContract:t,dialogueList:u,setIsContract:o,queryDialogueList:s,refreshDialogList:c},children:l})}},78915:function(e,l,t){"use strict";t.d(l,{Tk:function(){return u},Kw:function(){return c},PR:function(){return v},Ej:function(){return h}});var n=t(21628),i=t(24214),a=t(52040);let d=i.Z.create({baseURL:a.env.API_BASE_URL});d.defaults.timeout=1e4,d.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var o=t(84835);let r={"content-type":"application/json"},s=e=>{if(!(0,o.isPlainObject)(e))return JSON.stringify(e);let l={...e};for(let e in l){let t=l[e];"string"==typeof t&&(l[e]=t.trim())}return JSON.stringify(l)},u=(e,l)=>{if(l){let t=Object.keys(l).filter(e=>void 0!==l[e]&&""!==l[e]).map(e=>"".concat(e,"=").concat(l[e])).join("&");t&&(e+="?".concat(t))}return d.get("/api"+e,{headers:r}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},c=(e,l)=>{let t=s(l);return d.post("/api"+e,{body:t,headers:r}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},v=(e,l)=>d.post(e,l,{headers:r}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)}),h=(e,l)=>d.post(e,l).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[2180,7991,5757,7282,780,272,8942,7192,7518,5935,5086,4289,6316,1259,2657,5579,9253,5769,1744],function(){return e(e.s=86066)}),_N_E=e.O()}]);